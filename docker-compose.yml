version: '3.8'

services:
  psi-bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    container_name: psi-bot
    restart: unless-stopped
    volumes:
      # Персистентное хранение данных (кэш, лимиты API)
      - psi-bot-data:/app/data
    secrets:
      - psi_chat_bot
      - GEMINI_API_KEY
      - GOOGLE_API_KEY
      - GOOGLE_CSE_ID
      - STORAGE_CHAT_ID
      - IMAGE_SERVER_URL

# Именованный volume для данных
volumes:
  psi-bot-data:

    # Секреты берутся из /opt/psi-secrets/ — вне репозитория
    # Это позволяет делать git clone без потери секретов
    # На VPS создайте папку: mkdir -p /opt/psi-secrets
secrets:
  psi_chat_bot:
    file: /opt/psi-secrets/psi_chat_bot.txt
  GEMINI_API_KEY:
    file: /opt/psi-secrets/GEMINI_API_KEY.txt
  GOOGLE_API_KEY:
    file: /opt/psi-secrets/GOOGLE_API_KEY.txt
  GOOGLE_CSE_ID:
    file: /opt/psi-secrets/GOOGLE_CSE_ID.txt
  STORAGE_CHAT_ID:
    file: /opt/psi-secrets/STORAGE_CHAT_ID.txt
  IMAGE_SERVER_URL:
    file: /opt/psi-secrets/IMAGE_SERVER_URL.txt
