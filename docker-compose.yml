version: '3.8'

services:
  psi-bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    container_name: psi-bot
    restart: unless-stopped
    volumes:
      # Персистентное хранение данных (кэш, лимиты API)
      - psi-bot-data:/app/data
    secrets:
      - psi_chat_bot
      - GEMINI_API_KEY
      - GOOGLE_API_KEY
      - GOOGLE_CSE_ID
      - STORAGE_CHAT_ID
      - IMAGE_SERVER_URL

# Именованный volume для данных
volumes:
  psi-bot-data:

    # Секреты из ./secrets/ (скопируйте из secrets.example/ при первом деплое)
    # secrets/ в .gitignore — не перезаписываются при git pull
secrets:
  psi_chat_bot:
    file: ./secrets/psi_chat_bot.txt
  GEMINI_API_KEY:
    file: ./secrets/GEMINI_API_KEY.txt
  GOOGLE_API_KEY:
    file: ./secrets/GOOGLE_API_KEY.txt
  GOOGLE_CSE_ID:
    file: ./secrets/GOOGLE_CSE_ID.txt
  STORAGE_CHAT_ID:
    file: ./secrets/STORAGE_CHAT_ID.txt
  IMAGE_SERVER_URL:
    file: ./secrets/IMAGE_SERVER_URL.txt
